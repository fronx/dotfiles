jQuery(function ($) {

  var
    con = new WSWrapper({port: 8080, host: '127.0.0.1'});


  con.bind('open', function () {
    console.log('open');
  })
  .bind('close', function () {
    console.log('close');
  })
  .bind('message', function (msg) {
    var
      msg = $.parseJSON(msg),
      template = '{{>user}}<dd><p>{{text}}</p><small>{{{source}}}</small></dd>',
      partials = {
        user: '<dt><img src="{{profile_image_url}}" /><span>{{name}}</span></dt>'
      },
      tweet = $($.mustache(template, msg, partials));

    $('#page dialog').prepend(tweet);
  });


  window.connection = con;
});

